# 八、事务控制语言TCL

- 只有DML语句才会使用事务管理，DQL语句不使用的
- TCL的功能是可以保证在DML语句操作时的数据安全

```sql
转账为例：
存在一个银行账户张三，余额为1000，存在另一个银行账户李四，余额为0，
张三给李四转转账200:
	转账成功：账户张三先扣款200(update)成功,账户李四存款200(update)成功,转账成功。
				扣款：update account set balance=balance-200 where aid=1001;
				存款：update account set balance=balance+200 where aid=1002;
	转账失败：账户张三先扣款200(update)成功,账户李四存款200(update)失败,转账失败,张三扣款的200应该原路返回，但是对于数据库而言是不会执行该操作的。
				扣款：update account set balance=balance-200 where aid=1001;
				存款：update account set balance=balance+200 where aid=1003;
```

**注意：所有的DML语句操作全部要在事务管理的控制之下**

## **mysql数据库针对事务管理的处理：**

### 事务的自动提交：

- 默认的工作模式，只要存储引擎是InnoDB,事务管理是必定存在的
- 整个操作过程中，程序员无法参与其中，所有的工作都是存储引擎自动完成(和没有事务是一样的)

### 事务的手动提交：

- 可以调整工作模式为手动提交，在最终改变硬盘之前，需要程序员发送指令，根据不同的指令，要么继续执行，要么撤销执行。

### 调整事务工作模式：

- 临时性操作：执行操作一次，从自动提交改为手动提交
  - start transaction
- 永久性操作：执行操作一次，从自动提交改为手动提交
  - set autocommit = true/false（true自动提交，false手动提交）

### 操作指令：

- 事务提交：将执行过的DML语句改变硬盘
  - commit
- 事务回滚：撤销已经执行过的DML，回滚到开始开始操作时
  - rollback

以目前来说，使用的单个事务，数据不在出现任何问题了，如果是多个事务一块操作，数据安全依然存在问题。